name: Branch Name Check

on:
  pull_request:
    types: [opened, reopened, synchronize, edited]

jobs:
  check-branch-name:
    runs-on: ubuntu-latest
    steps:
      - name: Check branch name follows conventions
        run: |
          BRANCH="${{ github.head_ref }}"
          echo "Checking branch name: $BRANCH"
          
          # Define valid patterns
          # Pattern 1: story/bug/enabler/hotfix/copilot/feature with optional numeric ID
          # Examples: story/123-add-button, bug/fix-hover, enabler/upgrade-deps, hotfix/5.6.3-fix-build, copilot/add-feature, feature/new-component
          PATTERN1="^(story|bug|enabler|hotfix|copilot|feature)\/([0-9.-]+-)?[a-z0-9.-]+$"
          
          # Pattern 2: release branches
          # Example: release/5.6.x
          PATTERN2="^release\/[0-9]+\.[0-9]+\.x$"
          
          # Pattern 3: stable branches
          # Example: stable/5.n.0
          PATTERN3="^stable\/[0-9]+\.n\.0$"
          
          # Check if branch matches any pattern
          if [[ "$BRANCH" =~ $PATTERN1 ]] || [[ "$BRANCH" =~ $PATTERN2 ]] || [[ "$BRANCH" =~ $PATTERN3 ]]; then
            echo "✅ Branch name '$BRANCH' follows conventions"
            exit 0
          else
            echo "❌ Branch name '$BRANCH' does not follow naming conventions"
            echo ""
            echo "Expected patterns:"
            echo "  - story/[ID-]description    (e.g., story/123-add-button or story/add-button)"
            echo "  - bug/[ID-]description      (e.g., bug/456-fix-hover or bug/fix-hover)"
            echo "  - enabler/[ID-]description  (e.g., enabler/789-upgrade-deps)"
            echo "  - hotfix/[ID-]description   (e.g., hotfix/5.6.3-fix-build)"
            echo "  - copilot/[ID-]description  (e.g., copilot/add-feature or copilot/123-new-task)"
            echo "  - feature/[ID-]description  (e.g., feature/new-component or feature/456-add-ui)"
            echo "  - release/X.Y.x             (e.g., release/5.6.x)"
            echo "  - stable/X.n.0              (e.g., stable/5.n.0)"
            echo ""
            echo "Please rename your branch to follow conventions."
            echo "See CONTRIBUTING.md for details."
            exit 1
          fi
